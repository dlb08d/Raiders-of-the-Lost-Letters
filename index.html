<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Raiders of the Lost Letters</title>
<meta name="description" content="Embark on an epic spelling adventure! Spell words to guide your explorer across the treasure map and claim the gold. Miss a word? It returns until you master it. Beat your personal best and become a Raider of the Lost Letters!">
<style>
  :root{
    --bg:#0e0b05;
    --panel:#1b140a;
    --ink:#ead7a1;
    --ink-dark:#bda776;
    --accent:#e0b85a;
    --good:#35d16f;
    --bad:#ff6464;
    --ui:#2a2115;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    color:var(--ink); background:radial-gradient(circle at 60% 0%, #3a2a13 0%, #1a140a 50%, #0e0b05 100%);
    min-height:100dvh; display:grid; place-items:center; padding:20px;
    background-image:
      radial-gradient(transparent 0 6px, rgba(0,0,0,.18) 7px),
      repeating-linear-gradient(45deg, rgba(255,255,255,.03) 0 6px, rgba(0,0,0,.03) 6px 12px);
    background-blend-mode:multiply;
  }
  .card{
    width:min(980px,100%); background:rgba(40,29,16,.55);
    border:1px solid rgba(255,255,255,.07); border-radius:16px; padding:18px;
    box-shadow:0 10px 30px rgba(0,0,0,.45); backdrop-filter:blur(6px);
  }
  header{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px}
  h1{margin:0; font-size:22px; letter-spacing:.4px}
  .tagline{font-size:13px; color:#e7d6a1; opacity:.95}
  .muted{color:#cdbd90; opacity:.9; font-size:14px}
  .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
  .stats .stat{background:var(--ui); border:1px solid #3a2e1d; color:var(--ink); padding:6px 10px; border-radius:10px; font-size:13px}
  textarea, input[type="text"]{
    width:100%; background:var(--ui); border:1px solid #3a2e1d; color:var(--ink);
    padding:12px 14px; border-radius:10px; outline:none;
  }
  textarea{min-height:120px; resize:vertical}
  button{
    background:#3a2e1d; border:1px solid #4b3a22; color:var(--ink);
    padding:10px 14px; border-radius:10px; cursor:pointer; transition:transform .06s ease,border-color .2s ease;
  }
  button:hover{border-color:#705127}
  button:active{transform:translateY(1px)}
  button.primary{background:linear-gradient(180deg,#c99b3b,#a87a28); border-color:#c99b3b; color:#1a1207}
  button.ghost{background:transparent}
  label.pill{font-size:13px; padding:6px 10px; border-radius:999px; background:var(--ui); border:1px solid #3a2e1d}
  .hidden{display:none}
  .center{display:grid; place-items:center; text-align:center}
  .word-box{font-size:28px; font-weight:800; letter-spacing:.5px; margin:6px 0 2px}
  .status{min-height:22px}
  .status.good{color:var(--good)} .status.bad{color:var(--bad)}
  kbd{background:var(--ui); border:1px solid #3a2e1d; border-bottom-width:3px; padding:2px 6px; border-radius:6px; font-size:12px}

  /* Treasure map progress (SVG wrapper) */
  .map-wrap{position:relative; width:100%; height:130px; border:1px solid #3a2e1d; border-radius:12px; background:#2a2115; overflow:hidden}
  .parchment{
    position:absolute; inset:0; opacity:.25;
    background:
      radial-gradient(circle at 30% 20%, #fff8 0 2px, transparent 3px),
      radial-gradient(circle at 70% 70%, #fff8 0 2px, transparent 3px),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="100"><defs><filter id="n"><feTurbulence baseFrequency="0.01" numOctaves="2" seed="2"/></filter></defs><rect width="100%" height="100%" fill="%23cbb37a"/><rect width="100%" height="100%" fill="%23b99f67" filter="url(%23n)" opacity="0.4"/></svg>');
    background-size:cover;
  }

  /* Avatar & chest */
  .avatar, .chest{
    position:absolute; transform:translate(-50%,-50%); top:50%; width:60px; height:60px; pointer-events:none;
  }
  .avatar svg{filter:drop-shadow(0 4px 3px rgba(0,0,0,.5))}
  .chest svg{filter:drop-shadow(0 4px 3px rgba(0,0,0,.6))}
  .bounce{animation:bounce .6s ease}
  @keyframes bounce{0%{transform:translate(-50%,-55%)}50%{transform:translate(-50%,-50%)}100%{transform:translate(-50%,-52%)}}
  .shake{animation:shake .35s ease}
  @keyframes shake{
    0%,100%{transform:translate(-50%,-50%)}
    20%{transform:translate(calc(-50% + 6px),-50%)}
    40%{transform:translate(calc(-50% - 6px),-50%)}
    60%{transform:translate(calc(-50% + 4px),-50%)}
    80%{transform:translate(calc(-50% - 4px),-50%)}
  }

  /* Confetti */
  .confetti{position:fixed; inset:0; pointer-events:none}
  .confetti i{
    position:absolute; width:10px; height:10px; background:gold; opacity:0; animation:fall 1.2s ease forwards;
  }
  @keyframes fall{
    0%{opacity:1; transform:translateY(-20px) rotate(0)}
    100%{opacity:0; transform:translateY(120vh) rotate(720deg)}
  }

  .sr-only{position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden}
</style>
</head>
<body>
  <div class="card" role="application" aria-label="Raiders of the Lost Letters">
    <header>
      <div>
        <h1>üó∫Ô∏è Raiders of the Lost Letters</h1>
        <div class="tagline">Spell words to cross the treasure map. Missed words return until you master them‚Äîbeat your personal best!</div>
      </div>
      <div class="row stats">
        <div class="stat" id="statTotal">Words: 0</div>
        <div class="stat" id="statMastered">Mastered: 0</div>
        <div class="stat" id="statRepeats">Repeats: 0</div>
        <div class="stat" id="statBest">Personal Best: ‚Äî</div>
      </div>
    </header>

    <!-- Setup -->
    <section id="setup" class="grid" style="display:grid; gap:12px">
      <div class="muted">Paste or type words (one per line or commas). Wrong words repeat until all are correct. Score = how many repeats were needed (lower is better).</div>
      <textarea id="wordInput" placeholder="because
treasure
jungle
adventure
map
whisper
rhythm
friend
school
beautiful"></textarea>

      <div class="row">
        <label class="pill"><input type="checkbox" id="sayWords" checked> &nbsp;Speak the word</label>
        <label class="pill"><input type="checkbox" id="shuffle" checked> &nbsp;Shuffle order</label>
      </div>

      <div class="row">
        <button class="primary" id="startBtn">Start the Hunt</button>
      </div>
    </section>

    <!-- Play -->
    <section id="play" class="grid hidden" style="display:grid; gap:12px" aria-live="polite">
      <!-- Treasure map progress -->
      <div class="map-wrap" aria-hidden="true">
        <div class="parchment"></div>
        <!-- SVG path -->
        <svg id="map" viewBox="0 0 1000 220" preserveAspectRatio="none" style="position:absolute; inset:0">
          <path id="trail" d="M60,160 C150,60 260,200 340,120 S520,40 600,120 760,200 880,120"
                stroke="#8b5e2b" stroke-width="10" fill="none" stroke-linecap="round" stroke-dasharray="18 18"/>
          <!-- little X marks along path -->
          <g id="marks" stroke="#c99b3b" stroke-width="6">
            <line x1="120" y1="140" x2="134" y2="154"/>
            <line x1="134" y1="140" x2="120" y2="154"/>

            <line x1="300" y1="140" x2="314" y2="154"/>
            <line x1="314" y1="140" x2="300" y2="154"/>

            <line x1="520" y1="120" x2="534" y2="134"/>
            <line x1="534" y1="120" x2="520" y2="134"/>

            <line x1="720" y1="160" x2="734" y2="174"/>
            <line x1="734" y1="160" x2="720" y2="174"/>
          </g>
        </svg>
        <!-- Avatar (adventurer) -->
        <div class="avatar" id="avatar" style="left:60px">
          <svg viewBox="0 0 80 80" aria-hidden="true">
            <!-- Hat -->
            <ellipse cx="40" cy="26" rx="26" ry="8" fill="#4a3926"/>
            <path d="M28 15 q12-8 24 0 l-4 14 h-16z" fill="#3a2c1e"/>
            <!-- Head -->
            <circle cx="40" cy="36" r="10" fill="#f0c799"/>
            <!-- Body jacket -->
            <path d="M26 48 h28 l6 22 h-40z" fill="#5b3e24"/>
            <!-- Shirt + belt -->
            <rect x="36" y="48" width="8" height="8" fill="#d9d2c2"/>
            <rect x="24" y="58" width="32" height="4" fill="#3b2a15"/>
            <!-- Satchel strap -->
            <path d="M28 48 l24 22" stroke="#caa06a" stroke-width="4"/>
          </svg>
        </div>
        <!-- Treasure chest at end -->
        <div class="chest" id="chest" style="right:22px">
          <svg viewBox="0 0 80 80" aria-hidden="true">
            <rect x="10" y="30" width="60" height="30" rx="4" fill="#6b3f1f" stroke="#2c1b0e" stroke-width="3"/>
            <path d="M10 30 q30-18 60 0 v8 h-60z" fill="#8c5228" stroke="#2c1b0e" stroke-width="3"/>
            <rect x="37" y="40" width="6" height="10" fill="#c99b3b" />
          </svg>
        </div>
      </div>

      <div class="center">
        <div class="muted">Spell the word to move along the map:</div>
        <div class="word-box" id="prompt">‚Äî</div>
        <div class="row" style="margin-top:6px">
          <button id="hearBtn">üîä Hear</button>
          <button id="hintBtn" class="ghost">Hint</button>
          <button id="skipBtn" class="ghost">Skip</button>
          <button id="endBtn" class="ghost">End</button>
        </div>
      </div>

      <label class="sr-only" for="answer">Type your spelling</label>
      <input id="answer" type="text" placeholder="Type the word and press Enter" autocomplete="off" />

      <div id="feedback" class="status" aria-live="polite"></div>

      <div class="row">
        <div class="stats stat">Correct: <span id="statCorrect">0</span></div>
        <div class="stats stat">Wrong: <span id="statWrong">0</span></div>
      </div>
    </section>

    <!-- Results -->
    <section id="results" class="grid hidden center" style="gap:10px">
      <h2>üéâ You found the treasure!</h2>
      <div id="summary" class="muted"></div>
      <div id="bestNote" class="muted"></div>
      <div class="row" style="margin-top:10px">
        <button class="primary" id="restartBtn">Hunt Again</button>
        <button id="editBtn">Edit Word List</button>
      </div>
    </section>
  </div>

  <!-- Confetti layer -->
  <div id="confetti" class="confetti"></div>

<script>
(() => {
  // ---------- Helpers ----------
  const $ = s => document.querySelector(s);
  const normalize = w => w.toLowerCase().trim().replace(/[^a-z']/g, "");
  const shuffleArray = arr => arr.sort(() => Math.random() - 0.5);

  // Speech (optional)
  const speak = (text) => {
    if (!$('#sayWords').checked) return;
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 0.95; u.pitch = 1.0; u.lang = 'en-US';
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  };

  // Tiny sound generator (Web Audio API): coin, miss, fanfare
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function tone(freq=440, dur=0.12, type='sine', vol=0.2){
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq;
    g.gain.value = vol; o.connect(g); g.connect(audioCtx.destination);
    o.start();
    setTimeout(()=>{ o.stop(); }, dur*1000);
  }
  function coin(){
    tone(880, .07, 'square', .2); setTimeout(()=>tone(1320,.08,'square',.18),60);
  }
  function miss(){
    tone(220,.12,'sawtooth',.18); setTimeout(()=>tone(180,.14,'sawtooth',.16),90);
  }
  function fanfare(){
    [523,659,784,1046].forEach((f,i)=>setTimeout(()=>tone(f,.12,'triangle',.22), i*140));
  }

  // Confetti
  function burstConfetti(n=50){
    const layer = $('#confetti');
    for(let i=0;i<n;i++){
      const el = document.createElement('i');
      el.style.left = Math.random()*100 + 'vw';
      el.style.background = ['gold','#e0b85a','#ffd54a','#f5c36b'][i%4];
      el.style.animationDelay = (Math.random()*0.2)+'s';
      el.style.transform = `translateY(${Math.random()*-40}px) rotate(${Math.random()*180}deg)`;
      layer.appendChild(el);
      setTimeout(()=>layer.removeChild(el), 1400);
    }
  }

  // Progress along path
  let path, pathLength = 1;
  function setAvatarAt(pct){
    pct = Math.max(0, Math.min(1, pct));
    const d = pct * pathLength;
    const pt = path.getPointAtLength(d);
    const avatar = $('#avatar');
    avatar.style.left = (pt.x) + 'px';
    avatar.style.top  = (pt.y) + 'px';
  }

  // ---------- Game State ----------
  let queue = [];      // active items
  let current = null;
  let total = 0;
  let stats = { correct:0, wrong:0, attempts:0 };
  // "Repeats" = attempts - total (since each word must be answered at least once)
  function repeats(){ return Math.max(0, stats.attempts - total); }

  // word object: { raw, key, mastered:false }
  function parseWords(text){
    const parts = text.split(/[\n,]+/).map(w=>w.trim()).filter(Boolean);
    const seen = new Set();
    const list = [];
    for(const raw of parts){
      const key = normalize(raw);
      if(!key || seen.has(key)) continue;
      seen.add(key);
      list.push({ raw, key, mastered:false });
    }
    return list;
  }

  function start(){
    const raw = $('#wordInput').value;
    let words = parseWords(raw);
    if(words.length === 0){ alert("Please enter at least one word."); return; }
    if($('#shuffle').checked) shuffleArray(words);

    queue = words.slice();
    total = queue.length;
    stats = { correct:0, wrong:0, attempts:0 };

    // UI init
    $('#statTotal').textContent = `Words: ${total}`;
    $('#statMastered').textContent = `Mastered: 0/${total}`;
    $('#statCorrect').textContent = 0;
    $('#statWrong').textContent = 0;
    $('#statRepeats').textContent = `Repeats: 0`;
    const best = localStorage.getItem('treasure_best_repeats');
    $('#statBest').textContent = `Personal Best: ${best !== null ? best : '‚Äî'}`;

    $('#setup').classList.add('hidden');
    $('#results').classList.add('hidden');
    $('#play').classList.remove('hidden');

    // Map path init
    path = document.getElementById('trail');
    pathLength = path.getTotalLength ? path.getTotalLength() : 1000;
    setAvatarAt(0);

    $('#feedback').textContent = '';
    next();
  }

  function masteredCount(){ return queue.filter(w=>w.mastered).length; }

  function updateProgress(){
    const mastered = masteredCount();
    $('#statMastered').textContent = `Mastered: ${mastered}/${total}`;
    const pct = mastered / total;
    setAvatarAt(pct * 0.98); // stop near chest
  }

  function next(){
    // Trim mastered from front
    while(queue.length && queue[0].mastered) queue.shift();
    if(queue.length === 0){ finish(); return; }
    current = queue[0];
    $('#prompt').textContent = 'Type the word you hear';
    $('#answer').value = '';
    $('#answer').focus();
    $('#feedback').className = 'status';
    $('#feedback').textContent = '';
    speak(current.raw);
  }

  function submit(){
    if(!current) return;
    const val = normalize($('#answer').value);
    if(!val) return;
    stats.attempts++;

    if(val === current.key){
      current.mastered = true;
      stats.correct++;
      $('#statCorrect').textContent = stats.correct;
      $('#feedback').className = 'status good';
      $('#feedback').textContent = `‚úÖ Correct: ${current.raw}`;
      $('#avatar').classList.remove('shake');
      $('#avatar').classList.add('bounce');
      coin();

      // Move forward: remove from queue
      queue.shift();
      updateProgress();
      // tiny delay then next
      setTimeout(()=>{
        $('#avatar').classList.remove('bounce');
        next();
      }, 420);
    } else {
      stats.wrong++;
      $('#statWrong').textContent = stats.wrong;
      $('#feedback').className = 'status bad';
      $('#feedback').textContent = `‚ùå Oops. Correct is ‚Äú${current.raw}‚Äù. We'll try again soon.`;
      $('#avatar').classList.remove('bounce');
      $('#avatar').classList.add('shake');
      miss();

      // Reinsert a few spots later so it repeats soon
      queue.shift();
      const insertAt = Math.min(3, queue.length);
      queue.splice(insertAt, 0, current);

      // Update repeat count
      $('#statRepeats').textContent = `Repeats: ${repeats()}`;

      // Speak again after a beat
      setTimeout(()=>speak(current.raw), 350);
      setTimeout(()=>$('#avatar').classList.remove('shake'), 380);
      // proceed to next prompt
      setTimeout(next, 420);
    }
  }

  function hint(){
    if(!current) return;
    const first = current.raw[0];
    $('#feedback').className = 'status';
    $('#feedback').textContent = `Hint: starts with ‚Äú${first}‚Äù`;
    $('#answer').focus();
  }

  function skip(){
    if(!current) return;
    // gentle skip (does not count as wrong)
    queue.shift();
    queue.splice(Math.min(3, queue.length), 0, current);
    $('#feedback').className = 'status';
    $('#feedback').textContent = `Skipped. We'll come back to ‚Äú${current.raw}‚Äù.`;
    setTimeout(next, 260);
  }

  function finish(){
    // Move avatar to treasure
    setAvatarAt(0.995);
    fanfare(); burstConfetti(80);

    $('#play').classList.add('hidden');
    $('#results').classList.remove('hidden');

    const rpt = repeats();
    $('#summary').innerHTML = `Words: <b>${total}</b> ¬∑ Correct: <b>${stats.correct}</b> ¬∑ Wrong: <b>${stats.wrong}</b><br>
      <b>Repeats (score): ${rpt}</b> ‚Äî lower is better!`;

    // Personal best (fewest repeats)
    const key = 'treasure_best_repeats';
    const currBest = localStorage.getItem(key);
    let msg = '';
    if (currBest === null || rpt < Number(currBest)) {
      localStorage.setItem(key, String(rpt));
      msg = `üèÜ New personal best! Your best ‚Äúfewest repeats‚Äù is now <b>${rpt}</b>.`;
    } else {
      msg = `Best to beat: <b>${currBest}</b> repeats. Try to beat it next round!`;
    }
    $('#bestNote').innerHTML = msg;
    // Update header best for next round view
    $('#statBest').textContent = `Personal Best: ${localStorage.getItem(key)}`;
  }

  // ---------- Events ----------
  $('#startBtn').addEventListener('click', start);
  $('#answer').addEventListener('keydown', (e)=>{ if(e.key==='Enter') submit(); });
  $('#hearBtn').addEventListener('click', ()=>{ if(current) speak(current.raw); });
  $('#hintBtn').addEventListener('click', hint);
  $('#skipBtn').addEventListener('click', skip);
  $('#endBtn').addEventListener('click', finish);
  $('#restartBtn').addEventListener('click', ()=>{
    $('#results').classList.add('hidden');
    $('#setup').classList.remove('hidden');
  });
  $('#editBtn').addEventListener('click', ()=>{
    $('#results').classList.add('hidden');
    $('#setup').classList.remove('hidden');
  });

  // make buttons keyboard-friendly
  document.querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('keydown', e => { if(e.key===' ') e.preventDefault(); });
  });

  // Initialize header best on load
  const best = localStorage.getItem('treasure_best_repeats');
  $('#statBest').textContent = `Personal Best: ${best !== null ? best : '‚Äî'}`;
})();
</script>
</body>
</html>
